# ============================================================================
# Traefik Dynamic Configuration - Services
# ============================================================================
# Defines backend services using Docker internal DNS names
# These services must be running on the same Docker network (gradeloop-network)
# ============================================================================

http:
  services:
    # ========================================================================
    # Auth Service
    # ========================================================================
    auth-service:
      loadBalancer:
        servers:
          - url: "http://auth-service:8080"
        
        # Health check configuration
        healthCheck:
          path: /health
          interval: 30s
          timeout: 5s
          scheme: http
          headers:
            X-Health-Check: "true"
        
        # Sticky sessions (optional, for stateful auth)
        sticky:
          cookie:
            name: gradeloop_auth_session
            secure: true
            httpOnly: true
            sameSite: strict
        
        # Pass client IP to backend
        passHostHeader: true
    
    # ========================================================================
    # System Admin Service
    # ========================================================================
    system-admin-service:
      loadBalancer:
        servers:
          - url: "http://system-admin:8080"
        
        healthCheck:
          path: /health
          interval: 30s
          timeout: 5s
          scheme: http
        
        passHostHeader: true
    
    # ========================================================================
    # Institute Admin Service
    # ========================================================================
    institute-admin-service:
      loadBalancer:
        servers:
          - url: "http://institute-admin:8080"
        
        healthCheck:
          path: /health
          interval: 30s
          timeout: 5s
          scheme: http
        
        passHostHeader: true
    
    # ========================================================================
    # Instructor Service
    # ========================================================================
    instructor-service:
      loadBalancer:
        servers:
          - url: "http://instructor:8080"
        
        healthCheck:
          path: /health
          interval: 30s
          timeout: 5s
          scheme: http
        
        passHostHeader: true
    
    # ========================================================================
    # Student Service
    # ========================================================================
    student-service:
      loadBalancer:
        servers:
          - url: "http://student:8080"
        
        healthCheck:
          path: /health
          interval: 30s
          timeout: 5s
          scheme: http
        
        passHostHeader: true
    
    # ========================================================================
    # Health Service (Aggregated Health Check)
    # ========================================================================
    health-service:
      loadBalancer:
        servers:
          - url: "http://auth-service:8080"
        
        passHostHeader: true
    
    # ========================================================================
    # Service Resilience Configuration
    # ========================================================================
    # All services inherit these defaults unless overridden:
    # - Circuit breaker: Disabled by default (enable per service if needed)
    # - Retry: 3 attempts with exponential backoff
    # - Timeout: 30s per request
    # ========================================================================
